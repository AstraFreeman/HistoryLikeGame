<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–•—Ä–æ–Ω–æ–±—ñ–π: –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –±–∏—Ç–≤–∞</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            overflow: hidden;
        }
        
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
        }
        
        .ui-element {
            pointer-events: auto;
        }
        
        #game-title {
            text-align: center;
            padding: 20px;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.8), 0 0 40px rgba(255, 217, 61, 0.5);
            background: rgba(0, 0, 0, 0.3);
        }
        
        #score-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px 25px;
            border-radius: 10px;
            border: 2px solid #ff6b6b;
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
        }
        
        #score-panel h3 {
            margin-bottom: 10px;
            color: #ffd93d;
            text-shadow: 0 0 10px rgba(255, 217, 61, 0.6);
        }
        
        #accuracy-bar {
            width: 200px;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }
        
        #accuracy-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6b6b 0%, #ffd93d 50%, #6bcf7f 100%);
            transition: width 0.5s ease;
            border-radius: 15px;
        }
        
        #events-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 1000px;
        }
        
        #collapsible-content {
            transition: all 0.3s ease;
            max-height: 500px;
            overflow: hidden;
        }
        
        #collapsible-content.collapsed {
            max-height: 0;
        }
        
        #toggle-panel {
            background: rgba(0, 0, 0, 0.8);
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            text-align: center;
            cursor: pointer;
            border: 2px solid #4ecdc4;
            border-bottom: none;
            margin-bottom: -2px;
            transition: all 0.3s ease;
        }
        
        #toggle-panel:hover {
            background: rgba(0, 0, 0, 0.9);
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }
        
        #events-pool {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
            margin-bottom: 15px;
        }
        
        #events-pool h4 {
            margin-bottom: 15px;
            color: #4ecdc4;
            text-align: center;
            text-shadow: 0 0 10px rgba(78, 205, 196, 0.5);
        }
        
        #available-events {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            min-height: 60px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
        }
        
        #available-events::-webkit-scrollbar {
            width: 10px;
        }
        
        #available-events::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        #available-events::-webkit-scrollbar-thumb {
            background: #4ecdc4;
            border-radius: 10px;
        }
        
        #available-events::-webkit-scrollbar-thumb:hover {
            background: #44a08d;
        }
        
        .event-card {
            padding: 12px 20px;
            border-radius: 10px;
            cursor: grab;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            user-select: none;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        }
        
        .event-card.set-1 {
            background: linear-gradient(135deg, #3366ff 0%, #5580ff 100%);
            box-shadow: 0 0 15px rgba(51, 102, 255, 0.4);
        }
        
        .event-card.set-1:hover {
            box-shadow: 0 0 25px rgba(51, 102, 255, 0.6);
        }
        
        .event-card.set-2 {
            background: linear-gradient(135deg, #ffdd00 0%, #ffeb3b 100%);
            box-shadow: 0 0 15px rgba(255, 221, 0, 0.4);
            color: #333;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        
        .event-card.set-2:hover {
            box-shadow: 0 0 25px rgba(255, 221, 0, 0.6);
        }
        
        .event-card.set-3 {
            background: linear-gradient(135deg, #ff3333 0%, #ff5555 100%);
            box-shadow: 0 0 15px rgba(255, 51, 51, 0.4);
        }
        
        .event-card.set-3:hover {
            box-shadow: 0 0 25px rgba(255, 51, 51, 0.6);
        }
        
        .event-card:hover {
            transform: translateY(-5px);
        }
        
        .event-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        
        .event-card.in-sequence {
            box-shadow: 0 0 15px rgba(240, 147, 251, 0.4);
        }
        
        #sequence-area {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #ffd93d;
            box-shadow: 0 0 20px rgba(255, 217, 61, 0.3);
            margin-bottom: 15px;
        }
        
        #sequence-area h4 {
            margin-bottom: 15px;
            color: #ffd93d;
            text-align: center;
            text-shadow: 0 0 10px rgba(255, 217, 61, 0.5);
        }
        
        #sequence-slots {
            display: flex;
            gap: 10px;
            justify-content: center;
            min-height: 80px;
            align-items: center;
        }
        
        .sequence-slot {
            width: 200px;
            min-height: 70px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 217, 61, 0.5);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .sequence-slot.drag-over {
            background: rgba(255, 217, 61, 0.2);
            border-color: #ffd93d;
            box-shadow: 0 0 15px rgba(255, 217, 61, 0.5);
        }
        
        .sequence-slot.filled {
            border-style: solid;
            border-color: #ffd93d;
            box-shadow: 0 0 10px rgba(255, 217, 61, 0.4);
        }
        
        #controls {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .btn {
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        #charge-btn {
            background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
            color: white;
        }
        
        #fire-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
        }
        
        #reset-btn {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }
        
        #feedback {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px 50px;
            border-radius: 20px;
            border: 3px solid #ffd93d;
            display: none;
            max-width: 600px;
            text-align: center;
            animation: fadeIn 0.3s ease;
            z-index: 1000;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }
        
        #feedback h2 {
            margin-bottom: 15px;
            color: #ffd93d;
        }
        
        #feedback p {
            margin-bottom: 20px;
            line-height: 1.6;
            white-space: pre-line;
        }
        
        #feedback button {
            padding: 12px 30px;
            background: #4ecdc4;
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #feedback button:hover {
            background: #44a08d;
            transform: scale(1.05);
        }
        
        .accuracy-stars {
            font-size: 36px;
            margin: 20px 0;
            color: #ffd93d;
        }

        #feedback.error {
            border-color: #ff3333;
        }

        #feedback.error h2 {
            color: #ff3333;
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div id="ui-overlay">
        <div id="game-title" class="ui-element">
            ‚öîÔ∏è –•–†–û–ù–û–ë–Ü–ô: –Ü—Å—Ç–æ—Ä–∏—á–Ω–∞ –±–∏—Ç–≤–∞ –∑–∞ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å
        </div>
        
        <div id="score-panel" class="ui-element">
            <h3>–†—ñ–≤–µ–Ω—å: <span id="level">1</span></h3>
            <div>–ü–µ—Ä–µ–º–æ–≥–∏: <span id="wins">0</span></div>
            <div>–°–ø—Ä–æ–±–∏: <span id="attempts">0</span></div>
            <div id="accuracy-bar">
                <div id="accuracy-fill"></div>
            </div>
        </div>
        
        <div id="events-container" class="ui-element">
            <div id="toggle-panel">
                <span id="toggle-text">üîΩ –ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å</span>
            </div>
            
            <div id="collapsible-content">
                <div id="sequence-area">
                    <h4>üìã –ó–ê–†–Ø–î–ò–¢–ò –ó–ë–†–û–Æ (—Ä–æ–∑—Ç–∞—à—É–π—Ç–µ –ø–æ–¥—ñ—ó –≤—ñ–¥ –Ω–∞–π–¥–∞–≤–Ω—ñ—à–æ—ó –¥–æ –Ω–∞–π–Ω–æ–≤—ñ—à–æ—ó)</h4>
                    <div id="sequence-slots"></div>
                </div>
                
                <div id="events-pool">
                    <h4>üìú –î–û–°–¢–£–ü–ù–Ü –ü–û–î–Ü–á</h4>
                    <div id="available-events"></div>
                </div>
            </div>
            
            <div id="controls">
                <button id="charge-btn" class="btn">‚ö° –ó–ê–†–Ø–î–ò–¢–ò</button>
                <button id="fire-btn" class="btn" disabled>üéØ –í–Ü–î–°–¢–†–Ü–õ–ò–¢–ò</button>
                <button id="reset-btn" class="btn">üîÑ –°–ö–ò–ù–£–¢–ò</button>
            </div>
        </div>
        
        <div id="feedback" class="ui-element">
            <h2 id="feedback-title"></h2>
            <div class="accuracy-stars" id="stars"></div>
            <p id="feedback-text"></p>
            <button id="continue-btn">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</button>
        </div>
    </div>

    <script>
        // Three.js —Å—Ü–µ–Ω–∞
        let scene, camera, renderer, enemies = [], weapon, particles = [];
        let enemyDistance = 10;
        let gameState = {
            level: 1,
            wins: 0,
            attempts: 0,
            charged: false,
            chargedSetId: null
        };

        // –ó–≤—É–∫–æ–≤—ñ –µ—Ñ–µ–∫—Ç–∏
        const sounds = {
            shoot: new Audio('music/shoot.mp3'),
            reload: new Audio('music/reload.mp3'),
            enemyDefeat: new Audio('music/enemy_defeat.mp3')
        };

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥—É—á–Ω–æ—Å—Ç—ñ
        Object.values(sounds).forEach(sound => {
            sound.volume = 0.5;
        });

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—É–∫—É
        function playSound(soundName) {
            try {
                const sound = sounds[soundName];
                if (sound) {
                    sound.currentTime = 0;
                    sound.play().catch(err => console.log('Audio play prevented:', err));
                }
            } catch (err) {
                console.log('Audio error:', err);
            }
        }

        // –Ü–≥—Ä–æ–≤—ñ –¥–∞–Ω—ñ - 3 –Ω–∞–±–æ—Ä–∏ (—Ä–æ–∑—à–∏—Ä–µ–Ω—ñ)
        const scenarios = [
            {
                name: "–ö–∏—ó–≤—Å—å–∫–∞ –†—É—Å—å",
                setId: 1,
                color: 0x3366ff,
                events: [
                    { id: 1, text: "882 ‚Äî –û–±'—î–¥–Ω–∞–Ω–Ω—è –ø—ñ–≤–Ω—ñ—á–Ω–∏—Ö —ñ –ø—ñ–≤–¥–µ–Ω–Ω–∏—Ö –∑–µ–º–µ–ª—å", year: 882, setId: 1 },
                    { id: 2, text: "945 ‚Äî –°–º–µ—Ä—Ç—å –∫–Ω—è–∑—è –Ü–≥–æ—Ä—è, –ø–æ—á–∞—Ç–æ–∫ –ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –û–ª—å–≥–∏", year: 945, setId: 1 },
                    { id: 3, text: "988 ‚Äî –•—Ä–µ—â–µ–Ω–Ω—è –†—É—Å—ñ", year: 988, setId: 1 },
                    { id: 4, text: "1019 ‚Äî –ü–æ—á–∞—Ç–æ–∫ –ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ø—Ä–æ—Å–ª–∞–≤–∞ –ú—É–¥—Ä–æ–≥–æ", year: 1019, setId: 1 },
                    { id: 5, text: "1037 ‚Äî –ó–∞–∫–ª–∞–¥–µ–Ω–Ω—è –°–æ—Ñ—ñ–π—Å—å–∫–æ–≥–æ —Å–æ–±–æ—Ä—É –≤ –ö–∏—î–≤—ñ", year: 1037, setId: 1 },
                    { id: 6, text: "1051 ‚Äî –ó–∞—Å–Ω—É–≤–∞–Ω–Ω—è –ö–∏—î–≤–æ-–ü–µ—á–µ—Ä—Å—å–∫–æ–≥–æ –º–æ–Ω–∞—Å—Ç–∏—Ä—è", year: 1051, setId: 1 },
                    { id: 7, text: "1054 ‚Äî –°–º–µ—Ä—Ç—å –Ø—Ä–æ—Å–ª–∞–≤–∞ –ú—É–¥—Ä–æ–≥–æ", year: 1054, setId: 1 },
                    { id: 8, text: "1113 ‚Äî –ü–æ—á–∞—Ç–æ–∫ –ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –í–æ–ª–æ–¥–∏–º–∏—Ä–∞ –ú–æ–Ω–æ–º–∞—Ö–∞", year: 1113, setId: 1 },
                    { id: 9, text: "1169 ‚Äî –†–æ–∑–≥—Ä–æ–º –ö–∏—î–≤–∞ –ê–Ω–¥—Ä—ñ—î–º –ë–æ–≥–æ–ª—é–±—Å—å–∫–∏–º", year: 1169, setId: 1 },
                    { id: 10, text: "1240 ‚Äî –ó—Ä—É–π–Ω—É–≤–∞–Ω–Ω—è –ö–∏—î–≤–∞ –º–æ–Ω–≥–æ–ª–æ-—Ç–∞—Ç–∞—Ä–∞–º–∏", year: 1240, setId: 1 }
                ],
                explanation: "–ö–∏—ó–≤—Å—å–∫–∞ –†—É—Å—å –ø—Ä–æ–π—à–ª–∞ —à–ª—è—Ö –≤—ñ–¥ –æ–±'—î–¥–Ω–∞–Ω–Ω—è –∑–µ–º–µ–ª—å (882) —á–µ—Ä–µ–∑ —Ö—Ä–µ—â–µ–Ω–Ω—è (988), –∑–æ–ª–æ—Ç–∏–π –≤—ñ–∫ –Ø—Ä–æ—Å–ª–∞–≤–∞ –ú—É–¥—Ä–æ–≥–æ (1019-1054), –¥–æ –º–æ–Ω–≥–æ–ª—å—Å—å–∫–æ—ó –Ω–∞–≤–∞–ª–∏ (1240)."
            },
            {
                name: "–ö–æ–∑–∞—Ü—å–∫–∞ –£–∫—Ä–∞—ó–Ω–∞",
                setId: 2,
                color: 0xffdd00,
                events: [
                    { id: 11, text: "1591 ‚Äî –ü–µ—Ä—à–∞ –ø–∏—Å–µ–º–Ω–∞ –∑–≥–∞–¥–∫–∞ –ø—Ä–æ –∑–∞–ø–æ—Ä—ñ–∑—å–∫–µ –∫–æ–∑–∞—Ü—Ç–≤–æ", year: 1591, setId: 2 },
                    { id: 12, text: "1648 ‚Äî –ü–æ—á–∞—Ç–æ–∫ –ø–æ–≤—Å—Ç–∞–Ω–Ω—è –ë–æ–≥–¥–∞–Ω–∞ –•–º–µ–ª—å–Ω–∏—Ü—å–∫–æ–≥–æ", year: 1648, setId: 2 },
                    { id: 13, text: "1649 ‚Äî –ó–±–æ—Ä—ñ–≤—Å—å–∫–∏–π –º–∏—Ä", year: 1649, setId: 2 },
                    { id: 14, text: "1654 ‚Äî –ü–µ—Ä–µ—è—Å–ª–∞–≤—Å—å–∫–∞ —Ä–∞–¥–∞", year: 1654, setId: 2 },
                    { id: 15, text: "1657 ‚Äî –°–º–µ—Ä—Ç—å –ë–æ–≥–¥–∞–Ω–∞ –•–º–µ–ª—å–Ω–∏—Ü—å–∫–æ–≥–æ", year: 1657, setId: 2 },
                    { id: 16, text: "1687 ‚Äî –û–±—Ä–∞–Ω–Ω—è –Ü–≤–∞–Ω–∞ –ú–∞–∑–µ–ø–∏ –≥–µ—Ç—å–º–∞–Ω–æ–º", year: 1687, setId: 2 },
                    { id: 17, text: "1709 ‚Äî –ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –±–∏—Ç–≤–∞", year: 1709, setId: 2 },
                    { id: 18, text: "1734 ‚Äî –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ù–æ–≤–æ—ó –°—ñ—á—ñ", year: 1734, setId: 2 },
                    { id: 19, text: "1768 ‚Äî –ö–æ–ª—ñ—ó–≤—â–∏–Ω–∞ (–ø–æ–≤—Å—Ç–∞–Ω–Ω—è –ì–∞–π–¥–∞–º–∞–∫—ñ–≤)", year: 1768, setId: 2 },
                    { id: 20, text: "1775 ‚Äî –õ—ñ–∫–≤—ñ–¥–∞—Ü—ñ—è –ó–∞–ø–æ—Ä—ñ–∑—å–∫–æ—ó –°—ñ—á—ñ", year: 1775, setId: 2 }
                ],
                explanation: "–ö–æ–∑–∞—Ü—å–∫–∞ –¥–æ–±–∞ —Ä–æ–∑–ø–æ—á–∞–ª–∞—Å—è –∑ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –ó–∞–ø–æ—Ä—ñ–∑—å–∫–æ—ó –°—ñ—á—ñ (1591), –¥–æ—Å—è–≥–ª–∞ –ø—ñ–∫—É –ø—ñ–¥ —á–∞—Å –•–º–µ–ª—å–Ω–∏—á—á–∏–Ω–∏ (1648), –ø—Ä–æ–π—à–ª–∞ —á–µ—Ä–µ–∑ –ü–æ–ª—Ç–∞–≤—Å—å–∫—É –±–∏—Ç–≤—É (1709) —ñ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—è –ª—ñ–∫–≤—ñ–¥–∞—Ü—ñ—î—é –°—ñ—á—ñ (1775)."
            },
            {
                name: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ —Ä–µ–≤–æ–ª—é—Ü—ñ—è",
                setId: 3,
                color: 0xff3333,
                events: [
                    { id: 21, text: "1917 –±–µ—Ä. ‚Äî –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—ó –†–∞–¥–∏", year: 1917.03, setId: 3 },
                    { id: 22, text: "1917 —á–µ—Ä–≤. ‚Äî –ü–µ—Ä—à–∏–π –£–Ω—ñ–≤–µ—Ä—Å–∞–ª", year: 1917.06, setId: 3 },
                    { id: 23, text: "1917 –ª–∏–ø. ‚Äî –î—Ä—É–≥–∏–π –£–Ω—ñ–≤–µ—Ä—Å–∞–ª", year: 1917.07, setId: 3 },
                    { id: 24, text: "1917 –ª–∏—Å—Ç. ‚Äî –¢—Ä–µ—Ç—ñ–π –£–Ω—ñ–≤–µ—Ä—Å–∞–ª", year: 1917.11, setId: 3 },
                    { id: 25, text: "1918 —Å—ñ—á. ‚Äî –ß–µ—Ç–≤–µ—Ä—Ç–∏–π –£–Ω—ñ–≤–µ—Ä—Å–∞–ª (–ø—Ä–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –£–ù–†)", year: 1918.01, setId: 3 },
                    { id: 26, text: "1918 –∫–≤—ñ—Ç. ‚Äî –ì–µ—Ç—å–º–∞–Ω–∞—Ç –ü–∞–≤–ª–∞ –°–∫–æ—Ä–æ–ø–∞–¥—Å—å–∫–æ–≥–æ", year: 1918.04, setId: 3 },
                    { id: 27, text: "1918 –≥—Ä—É–¥. ‚Äî –ü–æ–≤—Å—Ç–∞–Ω–Ω—è –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó", year: 1918.12, setId: 3 },
                    { id: 28, text: "1919 —Å—ñ—á. ‚Äî –û–±'—î–¥–Ω–∞–Ω–Ω—è –£–ù–† —ñ –ó–£–ù–†", year: 1919.01, setId: 3 },
                    { id: 29, text: "1920 –∫–≤—ñ—Ç. ‚Äî –í–∞—Ä—à–∞–≤—Å—å–∫–∏–π –¥–æ–≥–æ–≤—ñ—Ä –∑ –ü–æ–ª—å—â–µ—é", year: 1920.04, setId: 3 },
                    { id: 30, text: "1921 –±–µ—Ä. ‚Äî –†–∏–∑—å–∫–∏–π –º–∏—Ä", year: 1921.03, setId: 3 }
                ],
                explanation: "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ —Ä–µ–≤–æ–ª—é—Ü—ñ—è 1917-1921 —Ä–æ–∫—ñ–≤ –ø—Ä–æ–π—à–ª–∞ –≤—ñ–¥ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ—ó –†–∞–¥–∏ (–±–µ—Ä–µ–∑–µ–Ω—å 1917) —á–µ—Ä–µ–∑ –ø—Ä–æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –Ω–µ–∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ (—Å—ñ—á–µ–Ω—å 1918), –ø–µ—Ä—ñ–æ–¥ –ì–µ—Ç—å–º–∞–Ω–∞—Ç—É —Ç–∞ –î–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, –¥–æ –ø–æ—Ä–∞–∑–∫–∏ –Ω–∞—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä—É—Ö—É (1921)."
            }
        ];

        let allEvents = [];
        scenarios.forEach(s => allEvents.push(...s.events));
        
        let availableEvents = [];
        let sequenceSlots = [];
        let draggedElement = null;
        let draggedType = null;
        let isPanelCollapsed = false;

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Three.js
        function initThree() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 15;
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            
            // –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const pointLight = new THREE.PointLight(0x00ff88, 1, 100);
            pointLight.position.set(0, 5, 10);
            scene.add(pointLight);
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ 3 –≤–æ—Ä–æ–≥—ñ–≤ –≤ —à–∞—Ö–º–∞—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
            scenarios.forEach((scenario, index) => {
                const enemyGeometry = new THREE.BoxGeometry(2, 2, 2);
                const enemyMaterial = new THREE.MeshPhongMaterial({ 
                    color: scenario.color,
                    emissive: scenario.color,
                    emissiveIntensity: 0.3
                });
                const enemy = new THREE.Mesh(enemyGeometry, enemyMaterial);
                
                // –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –≤ —à–∞—Ö–º–∞—Ç–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
                const xOffset = (index - 1) * 5;
                const zOffset = (index % 2 === 0) ? -enemyDistance : -enemyDistance - 2;
                enemy.position.set(xOffset, 3, zOffset);
                enemy.userData.setId = scenario.setId;
                enemy.userData.name = scenario.name;
                enemy.visible = true;
                
                scene.add(enemy);
                enemies.push(enemy);
            });
            
            // –ó–±—Ä–æ—è (—Ü–∏–ª—ñ–Ω–¥—Ä)
            const weaponGeometry = new THREE.CylinderGeometry(0.3, 0.3, 3, 16);
            const weaponMaterial = new THREE.MeshPhongMaterial({ 
                color: 0x444444,
                emissive: 0x00ffff,
                emissiveIntensity: 0.2
            });
            weapon = new THREE.Mesh(weaponGeometry, weaponMaterial);
            weapon.position.set(0, -2, 5);
            weapon.rotation.z = Math.PI / 2;
            scene.add(weapon);
            
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);
            
            enemies.forEach(enemy => {
                enemy.rotation.x += 0.01;
                enemy.rotation.y += 0.01;
            });
            
            particles.forEach((particle, index) => {
                particle.position.z -= 0.5;
                particle.scale.multiplyScalar(0.95);
                
                if (particle.scale.x < 0.01) {
                    scene.remove(particle);
                    particles.splice(index, 1);
                }
            });
            
            renderer.render(scene, camera);
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥—Ä–∏
        function initGame() {
            availableEvents = [...allEvents];
            shuffle(availableEvents);
            renderEvents();
            renderSequenceSlots();
            updateUI();
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function renderEvents() {
            const container = document.getElementById('available-events');
            container.innerHTML = '';
            
            availableEvents.forEach(event => {
                const card = document.createElement('div');
                card.className = `event-card set-${event.setId}`;
                card.textContent = event.text;
                card.draggable = true;
                card.dataset.eventId = event.id;
                card.dataset.setId = event.setId;
                card.dataset.type = 'event';
                
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
                
                container.appendChild(card);
            });
        }
        
        function renderSequenceSlots() {
            const container = document.getElementById('sequence-slots');
            container.innerHTML = '';
            sequenceSlots = [];
            
            for (let i = 0; i < 4; i++) {
                const slot = document.createElement('div');
                slot.className = 'sequence-slot';
                slot.dataset.slotIndex = i;
                slot.dataset.slotType = 'event';
                
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
                slot.addEventListener('dragleave', handleDragLeave);
                
                container.appendChild(slot);
                sequenceSlots.push(null);
            }
        }

        function handleDragStart(e) {
            draggedElement = e.target;
            draggedType = e.target.dataset.type;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            const slotType = e.currentTarget.dataset.slotType;
            
            if (draggedType === slotType) {
                e.currentTarget.classList.add('drag-over');
                e.dataTransfer.dropEffect = 'move';
            } else {
                e.dataTransfer.dropEffect = 'none';
            }
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (!draggedElement) return;
            
            const slotType = e.currentTarget.dataset.slotType;
            if (draggedType !== slotType) return;
            
            const slotIndex = parseInt(e.currentTarget.dataset.slotIndex);
            const eventId = parseInt(draggedElement.dataset.eventId);
            
            if (sequenceSlots[slotIndex]) {
                const oldEvent = allEvents.find(ev => ev.id === sequenceSlots[slotIndex]);
                availableEvents.push(oldEvent);
            }
            
            sequenceSlots[slotIndex] = eventId;
            const event = allEvents.find(ev => ev.id === eventId);
            availableEvents = availableEvents.filter(ev => ev.id !== eventId);
            
            e.currentTarget.innerHTML = '';
            const card = draggedElement.cloneNode(true);
            card.classList.add('in-sequence');
            card.classList.add(`set-${event.setId}`);
            card.draggable = false;
            
            const removeBtn = document.createElement('span');
            removeBtn.textContent = ' ‚ùå';
            removeBtn.style.cursor = 'pointer';
            removeBtn.style.marginLeft = '8px';
            removeBtn.onclick = () => removeFromSequence(slotIndex);
            card.appendChild(removeBtn);
            
            e.currentTarget.appendChild(card);
            e.currentTarget.classList.add('filled');
            
            renderEvents();
            draggedElement = null;
        }

        function removeFromSequence(slotIndex) {
            const eventId = sequenceSlots[slotIndex];
            if (!eventId) return;
            
            const event = allEvents.find(ev => ev.id === eventId);
            availableEvents.push(event);
            sequenceSlots[slotIndex] = null;
            
            const slots = document.querySelectorAll('.sequence-slot');
            slots[slotIndex].innerHTML = '';
            slots[slotIndex].classList.remove('filled');
            
            renderEvents();
        }

        function checkSequence() {
            // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ —Å–ª–æ—Ç–∏
            const filledSlots = sequenceSlots
                .map((eventId, index) => ({ eventId, index }))
                .filter(slot => slot.eventId !== null);
            
            if (filledSlots.length < 2) {
                showFeedback(0, "–ü–û–ú–ò–õ–ö–ê! ‚ö†Ô∏è", "–ù–µ–æ–±—Ö—ñ–¥–Ω–æ —Ä–æ–∑–º—ñ—Å—Ç–∏—Ç–∏ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 2 –ø–æ–¥—ñ—ó!", false);
                return;
            }
            
            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –º—ñ—à–∞–Ω–∏–π –Ω–∞–±—ñ—Ä
            const usedSetIds = new Set();
            for (let slot of filledSlots) {
                const event = allEvents.find(ev => ev.id === slot.eventId);
                usedSetIds.add(event.setId);
            }
            
            if (usedSetIds.size > 1) {
                showFeedback(0, "–ü–û–ú–ò–õ–ö–ê! –ú–Ü–®–ê–ù–ò–ô –ù–ê–ë–Ü–†! ‚ö†Ô∏è", "–í–∏ –æ–±—Ä–∞–ª–∏ –ø–æ–¥—ñ—ó –∑ —Ä—ñ–∑–Ω–∏—Ö —ñ—Å—Ç–æ—Ä–∏—á–Ω–∏—Ö –ø–µ—Ä—ñ–æ–¥—ñ–≤! –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–æ–¥—ñ—ó —Ç—ñ–ª—å–∫–∏ –∑ –æ–¥–Ω–æ–≥–æ –Ω–∞–±–æ—Ä—É:\nüîµ –ö–∏—ó–≤—Å—å–∫–∞ –†—É—Å—å\nüü° –ö–æ–∑–∞—Ü—å–∫–∞ –£–∫—Ä–∞—ó–Ω–∞\nüî¥ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ —Ä–µ–≤–æ–ª—é—Ü—ñ—è", true);
                return;
            }
            
            gameState.attempts++;
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ –Ω–∞–±—ñ—Ä
            const setId = Array.from(usedSetIds)[0];
            const currentScenario = scenarios.find(s => s.setId === setId);
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω—É –ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å
            const accuracy = calculateSequenceAccuracy(filledSlots, currentScenario);
            
            updateAccuracyBar(accuracy);
            
            if (accuracy === 5) {
                playSound('reload');
                gameState.charged = true;
                gameState.chargedSetId = setId;
                document.getElementById('charge-btn').disabled = true;
                document.getElementById('fire-btn').disabled = false;
                
                animateCharging();
                showFeedback(accuracy, "–ó–ë–†–û–Æ –ó–ê–†–Ø–î–ñ–ï–ù–û! ‚úÖ", `–ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞!\n–ó–∞—Ä—è–¥–∂–µ–Ω–æ –¥–ª—è –∑–Ω–∏—â–µ–Ω–Ω—è: ${currentScenario.name}\n–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å '–í–Ü–î–°–¢–†–Ü–õ–ò–¢–ò' –¥–ª—è –∞—Ç–∞–∫–∏!`, false);
            } else {
                const hint = getDetailedHint(filledSlots, currentScenario);
                showFeedback(accuracy, "–ü–û–ú–ò–õ–ö–ê –í –ü–û–°–õ–Ü–î–û–í–ù–û–°–¢–Ü ‚ö†Ô∏è", 
                    `–¢–æ—á–Ω—ñ—Å—Ç—å: ${accuracy}/5\n\n${hint}\n\n${currentScenario.explanation}`, false);
            }
            
            updateUI();
        }

        function calculateSequenceAccuracy(filledSlots, scenario) {
            // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–¥—ñ—ó —É –ø–æ—Ä—è–¥–∫—É —Ä–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è
            const userEvents = filledSlots.map(slot => {
                return allEvents.find(ev => ev.id === slot.eventId);
            });
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–æ–¥—ñ—ó –π–¥—É—Ç—å —É —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
            let isChronological = true;
            for (let i = 0; i < userEvents.length - 1; i++) {
                if (userEvents[i].year > userEvents[i + 1].year) {
                    isChronological = false;
                    break;
                }
            }
            
            if (!isChronological) {
                // –†–∞—Ö—É—î–º–æ —Å–∫—ñ–ª—å–∫–∏ –ø–∞—Ä –ø–æ–¥—ñ–π —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
                let correctPairs = 0;
                let totalPairs = 0;
                for (let i = 0; i < userEvents.length - 1; i++) {
                    for (let j = i + 1; j < userEvents.length; j++) {
                        totalPairs++;
                        if (userEvents[i].year < userEvents[j].year) {
                            correctPairs++;
                        }
                    }
                }
                
                const pairAccuracy = totalPairs > 0 ? correctPairs / totalPairs : 0;
                
                if (pairAccuracy >= 0.9) return 4;
                if (pairAccuracy >= 0.7) return 3;
                if (pairAccuracy >= 0.5) return 2;
                return 1;
            }
            
            // –Ø–∫—â–æ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—á–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø–æ–≤–Ω–æ—Ç—É —Ç–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å
            const allScenarioEvents = [...scenario.events].sort((a, b) => a.year - b.year);
            const userYears = userEvents.map(e => e.year);
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ü–µ –ø—ñ–¥–ø–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ
            let scenarioIndex = 0;
            let matchedCount = 0;
            
            for (let userEvent of userEvents) {
                while (scenarioIndex < allScenarioEvents.length) {
                    if (allScenarioEvents[scenarioIndex].id === userEvent.id) {
                        matchedCount++;
                        scenarioIndex++;
                        break;
                    }
                    scenarioIndex++;
                }
            }
            
            // –Ø–∫—â–æ –≤—Å—ñ –ø–æ–¥—ñ—ó –∑–±—ñ–≥–∞—é—Ç—å—Å—è —É –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É
            if (matchedCount === userEvents.length) {
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –ø–æ–≤–Ω–æ—Ç—É (–º—ñ–Ω—ñ–º—É–º 4 –ø–æ–¥—ñ—ó –¥–ª—è –ø–æ–≤–Ω–æ—ó –∑–∞—Ä—è–¥–∫–∏)
                if (userEvents.length >= 4) {
                    return 5; // –ü–æ–≤–Ω–∞ –∑–∞—Ä—è–¥–∫–∞
                } else if (userEvents.length === 3) {
                    return 4;
                } else {
                    return 3;
                }
            }
            
            return 2;
        }

        function getDetailedHint(filledSlots, scenario) {
            const userEvents = filledSlots.map(slot => {
                return allEvents.find(ev => ev.id === slot.eventId);
            });
            
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –ø–æ–º–∏–ª–∫–∏ –≤ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ
            const errors = [];
            for (let i = 0; i < userEvents.length - 1; i++) {
                if (userEvents[i].year > userEvents[i + 1].year) {
                    errors.push(`"${userEvents[i].text}" (${Math.floor(userEvents[i].year)}) –º–∞—î –±—É—Ç–∏ –ü–Ü–°–õ–Ø "${userEvents[i + 1].text}" (${Math.floor(userEvents[i + 1].year)})`);
                }
            }
            
            if (errors.length > 0) {
                return "–ü–æ–º–∏–ª–∫–∏ –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—ó:\n" + errors.slice(0, 2).join("\n");
            }
            
            if (userEvents.length < 4) {
                return `–ü–æ—Å–ª—ñ–¥–æ–≤–Ω—ñ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞, –∞–ª–µ –¥–æ–¥–∞–π—Ç–µ —â–µ ${4 - userEvents.length} –ø–æ–¥—ñ—ó –¥–ª—è –ø–æ–≤–Ω–æ—ó –∑–∞—Ä—è–¥–∫–∏!`;
            }
            
            return "–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—Ä—è–¥–æ–∫ –ø–æ–¥—ñ–π —É–≤–∞–∂–Ω—ñ—à–µ.";
        }

        function animateCharging() {
            let pulse = 0;
            const interval = setInterval(() => {
                weapon.material.emissive = new THREE.Color(0x00ff00);
                weapon.material.emissiveIntensity = Math.sin(pulse) * 0.5 + 0.5;
                pulse += 0.2;
            }, 50);
            
            setTimeout(() => clearInterval(interval), 2000);
        }

        function fireWeapon() {
            if (!gameState.charged) return;
            
            playSound('shoot');
            
            // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –≤–æ—Ä–æ–≥–∞ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º setId
            const targetEnemy = enemies.find(e => e.userData.setId === gameState.chargedSetId && e.visible);
            
            if (!targetEnemy) {
                showFeedback(0, "–ü–û–ú–ò–õ–ö–ê! ‚ö†Ô∏è", "–í–æ—Ä–æ–≥–∞ –¥–ª—è —Ü—å–æ–≥–æ –Ω–∞–±–æ—Ä—É –≤–∂–µ –∑–Ω–∏—â–µ–Ω–æ!", false);
                return;
            }
            
            const beamGeometry = new THREE.CylinderGeometry(0.1, 0.1, 20, 16);
            const beamMaterial = new THREE.MeshBasicMaterial({ 
                color: 0x00ff00,
                transparent: true,
                opacity: 0.8
            });
            const beam = new THREE.Mesh(beamGeometry, beamMaterial);
            beam.position.set(0, -2, -5);
            beam.rotation.z = Math.PI / 2;
            scene.add(beam);
            
            let beamPos = 5;
            const shootInterval = setInterval(() => {
                beamPos -= 1;
                beam.position.z = beamPos;
                beam.material.opacity -= 0.05;
                
                if (beamPos < targetEnemy.position.z + 2) {
                    clearInterval(shootInterval);
                    scene.remove(beam);
                    destroyEnemy(targetEnemy);
                    
                    // –û—á–∏—â—É—î–º–æ –ø–∞–Ω–µ–ª—å —Ç–∞ –æ–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–±—ñ—Ä –ø–∏—Ç–∞–Ω—å
                    clearSequencePanel();
                    initGame();
                }
            }, 30);
        }

        function destroyEnemy(targetEnemy) {
            playSound('enemyDefeat');
            
            for (let i = 0; i < 30; i++) {
                const geometry = new THREE.SphereGeometry(0.2, 8, 8);
                const material = new THREE.MeshBasicMaterial({ 
                    color: targetEnemy.material.color
                });
                const particle = new THREE.Mesh(geometry, material);
                particle.position.copy(targetEnemy.position);
                particle.velocity = new THREE.Vector3(
                    (Math.random() - 0.5) * 0.5,
                    (Math.random() - 0.5) * 0.5,
                    (Math.random() - 0.5) * 0.5
                );
                scene.add(particle);
                particles.push(particle);
                
                setTimeout(() => {
                    scene.remove(particle);
                }, 2000);
            }
            
            targetEnemy.visible = false;
            
            gameState.wins++;
            gameState.charged = false;
            gameState.chargedSetId = null;
            
            document.getElementById('charge-btn').disabled = false;
            document.getElementById('fire-btn').disabled = true;
            
            weapon.material.emissive = new THREE.Color(0x00ffff);
            weapon.material.emissiveIntensity = 0.2;
            
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—ñ –≤–æ—Ä–æ–≥–∏ –∑–Ω–∏—â–µ–Ω—ñ
            const allDestroyed = enemies.every(e => !e.visible);
            
            setTimeout(() => {
                if (allDestroyed) {
                    showFeedback(5, "–ü–ï–†–ï–ú–û–ì–ê! üéâ", `–í—Å—ñ—Ö –≤–æ—Ä–æ–≥—ñ–≤ –∑–Ω–∏—â–µ–Ω–æ!\n–í–∏ –ø—Ä–æ–π—à–ª–∏ —Ä—ñ–≤–µ–Ω—å ${gameState.level}!\n–ì–æ—Ç—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ —Ä—ñ–≤–Ω—è!`, false);
                } else {
                    showFeedback(5, `–í–û–†–û–ì–ê –ó–ù–ò–©–ï–ù–û! üéØ`, `–í–∏ –∑–Ω–∏—â–∏–ª–∏ –≤–æ—Ä–æ–≥–∞: ${targetEnemy.userData.name}\n–ü—Ä–æ–¥–æ–≤–∂—É–π—Ç–µ –±–∏—Ç–≤—É!`, false);
                }
            }, 500);
        }

        function showFeedback(accuracy, title, text, isError) {
            const feedback = document.getElementById('feedback');
            document.getElementById('feedback-title').textContent = title;
            document.getElementById('feedback-text').textContent = text;
            
            if (isError) {
                feedback.classList.add('error');
                document.getElementById('stars').textContent = '‚ùå';
            } else {
                feedback.classList.remove('error');
                const stars = '‚≠ê'.repeat(accuracy);
                document.getElementById('stars').textContent = stars;
            }
            
            feedback.style.display = 'block';
        }

        function hideFeedback() {
            document.getElementById('feedback').style.display = 'none';
        }

        function nextLevel() {
            hideFeedback();
            
            gameState.level++;
            enemyDistance = 10;
            
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –≤—Å—ñ—Ö –≤–æ—Ä–æ–≥—ñ–≤
            enemies.forEach((enemy, index) => {
                enemy.visible = true;
                const xOffset = (index - 1) * 5;
                const zOffset = (index % 2 === 0) ? -enemyDistance : -enemyDistance - 2;
                enemy.position.set(xOffset, 3, zOffset);
            });
            
            weapon.material.emissive = new THREE.Color(0x00ffff);
            weapon.material.emissiveIntensity = 0.2;
            
            document.getElementById('charge-btn').disabled = false;
            document.getElementById('fire-btn').disabled = true;
            
            gameState.charged = false;
            gameState.chargedSetId = null;
            
            initGame();
        }

        function resetGame() {
            clearSequencePanel();
            availableEvents = [...allEvents];
            shuffle(availableEvents);
            gameState.charged = false;
            gameState.chargedSetId = null;
            
            document.getElementById('charge-btn').disabled = false;
            document.getElementById('fire-btn').disabled = true;
            
            updateAccuracyBar(0);
            renderEvents();
            renderSequenceSlots();
        }

        function clearSequencePanel() {
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –≤—Å—ñ –ø–æ–¥—ñ—ó –∑ –ø–∞–Ω–µ–ª—ñ –Ω–∞–∑–∞–¥ —É –¥–æ—Å—Ç—É–ø–Ω—ñ
            sequenceSlots.forEach(eventId => {
                if (eventId !== null) {
                    const event = allEvents.find(ev => ev.id === eventId);
                    if (event && !availableEvents.find(e => e.id === eventId)) {
                        availableEvents.push(event);
                    }
                }
            });
            
            // –û—á–∏—â—É—î–º–æ —Å–ª–æ—Ç–∏
            sequenceSlots = [];
            const slots = document.querySelectorAll('.sequence-slot');
            slots.forEach(slot => {
                slot.innerHTML = '';
                slot.classList.remove('filled');
            });
        }

        function updateAccuracyBar(accuracy) {
            const fill = document.getElementById('accuracy-fill');
            fill.style.width = (accuracy / 5 * 100) + '%';
        }

        function updateUI() {
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('wins').textContent = gameState.wins;
            document.getElementById('attempts').textContent = gameState.attempts;
        }

        function togglePanel() {
            const content = document.getElementById('collapsible-content');
            const toggleText = document.getElementById('toggle-text');
            
            isPanelCollapsed = !isPanelCollapsed;
            
            if (isPanelCollapsed) {
                content.classList.add('collapsed');
                toggleText.textContent = 'üîº –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
            } else {
                content.classList.remove('collapsed');
                toggleText.textContent = 'üîΩ –ó–≥–æ—Ä–Ω—É—Ç–∏ –ø–∞–Ω–µ–ª—å';
            }
        }

        // –û–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
        document.getElementById('charge-btn').addEventListener('click', checkSequence);
        document.getElementById('fire-btn').addEventListener('click', fireWeapon);
        document.getElementById('reset-btn').addEventListener('click', resetGame);
        document.getElementById('toggle-panel').addEventListener('click', togglePanel);
        document.getElementById('continue-btn').addEventListener('click', () => {
            // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—Å—ñ –≤–æ—Ä–æ–≥–∏ –∑–Ω–∏—â–µ–Ω—ñ
            const allDestroyed = enemies.every(e => !e.visible);
            
            if (allDestroyed) {
                nextLevel();
            } else {
                hideFeedback();
            }
        });

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // –ó–∞–ø—É—Å–∫ –≥—Ä–∏
        initThree();
        initGame();
    </script>
</body>
</html>