<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>AR Poster Viewer</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body { margin: 0; overflow: hidden; }
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 20px;
            z-index: 1000;
        }
    </style>
    <script>
        // Function to restart the page
        function restartPage() {
            location.reload();
        }

        // Function to open Kvebek3.html
        function openKvebek3() {
            window.location.href = 'Kvebek3.html';
        }

        // Add event listeners after the scene is loaded
        window.addEventListener('DOMContentLoaded', function() {
            // Log when model is loaded
            const scene = document.querySelector('a-scene');
            scene.addEventListener('loaded', function() {
                console.log('Scene loaded');
            });

            AFRAME.registerComponent('button-handler', {
                init: function() {
                    var el = this.el;
                    el.addEventListener('click', function() {
                        console.log('Button clicked:', this.id);
                        switch(this.id) {
                            case 'restart-button-1':
                            case 'restart-button-2':
                                restartPage();
                                break;
                            case 'no-result-button':
                                alert('No action assigned to this button.');
                                break;
                            case 'kvebek-button':
                                openKvebek3();
                                break;
                        }
                    });
                }
            });

            // Component to handle model loading
            AFRAME.registerComponent('model-handler', {
                init: function() {
                    this.el.addEventListener('model-loaded', function() {
                        console.log('3D Model loaded successfully!');
                    });
                    this.el.addEventListener('model-error', function(error) {
                        console.error('Error loading 3D model:', error);
                    });
                }
            });
        });
    </script>
</head>
<body>
    <div class="loading" id="loading">Loading AR...</div>

    <a-scene 
        embedded 
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false">
        
        <a-assets timeout="10000">
            <img id="rev" src="image/22_1.jpg" crossorigin="anonymous">
            <img id="ww2" src="image/29_1.jpg" crossorigin="anonymous">
            <img id="krch" src="image/30_1.jpg" crossorigin="anonymous">
            <a-asset-item id="drakkar-glb" src="models/drakar.glb" crossorigin="anonymous"></a-asset-item>
        </a-assets>

        <a-marker preset="hiro" id="hiro-marker">
            <!-- Title Plane -->
            <a-text 
                value="Choose a Poster of the «Thaw»" 
                align="center" 
                position="0 0.8 -0.6" 
                rotation="0 0 0" 
                color="black"
                scale="0.5 0.5 0.5">
            </a-text>

            <!-- 3D Model (Drakkar) - Center, visible -->
            <a-entity 
                id="drakkar-model"
                gltf-model="#drakkar-glb"
                model-handler
                position="0 -0.3 0"
                rotation="0 0 0"
                scale="0.05 0.05 0.05"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear">
            </a-entity>

            <!-- First Image Plane (KRCH) - Right -->
            <a-plane 
                id="krch-image"
                position="0.6 0 0" 
                rotation="0 90 0" 
                width="1.5" 
                height="2" 
                scale="0.5 0.5 0.5"
                color="white" 
                src="#krch"
                material="shader: flat">
            </a-plane>

            <!-- Kvebek Button (Green) - Above KRCH -->
            <a-entity 
                id="kvebek-button" 
                position="0.6 0.6 0" 
                rotation="90 0 0" 
                button-handler>
                <a-box 
                    color="#00FF00" 
                    depth="0.2" 
                    height="0.4" 
                    width="0.4">
                </a-box>
            </a-entity>

            <!-- Second Image Plane (WW2) - Left -->
            <a-plane 
                id="ww2-image"
                position="-0.6 0 0" 
                rotation="0 -90 0" 
                width="1.5" 
                height="2" 
                color="white" 
                scale="0.5 0.5 0.5"
                src="#ww2"
                material="shader: flat">
            </a-plane>

            <!-- First Restart Button (Blue) - Above WW2 -->
            <a-entity 
                id="restart-button-1" 
                position="-0.6 0.6 0" 
                rotation="90 0 0" 
                button-handler>
                <a-box 
                    color="#4CC3D9" 
                    depth="0.2" 
                    height="0.4" 
                    width="0.4">
                </a-box>
            </a-entity>

            <!-- Third Image Plane (Revolution) - Front -->
            <a-plane 
                id="rev-image"
                position="0 0 0.6"
                rotation="0 0 0" 
                width="1.5" 
                height="2" 
                scale="0.5 0.5 0.5"
                color="white" 
                src="#rev"
                material="shader: flat"
                data-image="true">
            </a-plane>

            <!-- No Result Button (Red) - Above Revolution -->
            <a-entity 
                id="no-result-button" 
                position="0 0.6 0.6" 
                rotation="90 0 0" 
                button-handler>
                <a-box 
                    color="#FF0000" 
                    depth="0.2" 
                    height="0.4" 
                    width="0.4">
                </a-box>
            </a-entity>

            <!-- Second Restart Button (Purple) - Back -->
            <a-entity 
                id="restart-button-2" 
                position="0 0.6 -0.6" 
                rotation="90 0 0" 
                button-handler>
                <a-box 
                    color="#800080" 
                    depth="0.2" 
                    height="0.4" 
                    width="0.4">
                </a-box>
            </a-entity>
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // Hide loading message when scene is ready
        document.querySelector('a-scene').addEventListener('loaded', function() {
            document.getElementById('loading').style.display = 'none';
        });
    </script>
</body>
</html>
